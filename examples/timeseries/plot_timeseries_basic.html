<!doctype html>
<html lang="en">


  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="../../_static/custom.css" type=text/css>

    <title>Python Resources for CAM-chem</title>

    <script src="https://kit.fontawesome.com/be4ef5002e.js" crossorigin="anonymous"></script>
  </head>


  <body>


    <nav class="navbar navbar-expand navbar-dark sticky-top bg-dark">
      <a class="navbar-brand" style="font-weight:bold" href="../../index.html">Python resources for CAM-chem</a>
      <ul class="navbar-nav mr-auto">
      </ul>
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" style="line-height:1.8em" href="https://wiki.ucar.edu/display/camchem/Home">CAM-chem Wiki</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/NCAR/CAM-chem"><i class="fab fa-github"></i></a>
        </li>
      </ul>
    </nav>



    <div class="container-fluid">

      <!-- Sidebar -->
      <nav class="sidebar" >
        <div class="sidebar-header">
          <h4></h4>
        </div>
        <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
</ul>
<p class="caption"><span class="caption-text">EXAMPLES</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../curtains.html">Curtains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../emissions.html">Emissions processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io.html">I/O tips and tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maps.html">Maps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../profiles.html">Profiles</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../timeseries.html">Timeseries</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_timeseries_customize.html">Customization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../widget.html">Widget</a></li>
</ul>
<p class="caption"><span class="caption-text">DOWNLOAD SAMPLE DATA</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://acomstaff.acom.ucar.edu/CESM/sample.nc"> CAM-chem sample</a></li>
<li class="toctree-l1"><a class="reference external" href="https://acomstaff.acom.ucar.edu/CESM/sample_se.nc"> MUSICA sample</a></li>
</ul>

        
      </nav>


      <!-- Page Content -->
      <main role="main" class="content" style="min-height:700px;">
        
  <div class="section" id="timeseries-basic-plot">
<h1>Timeseries - basic plot<a class="headerlink" href="#timeseries-basic-plot" title="Permalink to this headline">¶</a></h1>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># By line: RRB 2020-07-28
# Script aims to:
# - Load multiple netCDF files
# - Extract one variable: CO
# - Choose a specific location from model grid
# - Plot timeseries
</pre></div>
</div>
<div class="section" id="load-python-packages">
<h2>Load python packages<a class="headerlink" href="#load-python-packages" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd
from pandas.tseries.offsets import DateOffset
import xarray as xr
import matplotlib.pyplot as plt
import numpy as np
from scipy.interpolate import griddata
import datetime
from pathlib import Path                   # System agnostic paths
</pre></div>
</div>
</div>
<div class="section" id="create-reusable-functions">
<h2>Create reusable functions<a class="headerlink" href="#create-reusable-functions" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Find nearest index
def find_index(array,x):
    idx = np.argmin(np.abs(array-x))
    return idx
</pre></div>
</div>
</div>
<div class="section" id="load-model-data">
<h2>Load model Data:<a class="headerlink" href="#load-model-data" title="Permalink to this headline">¶</a></h2>
<p>Define the directories and file of interest for your results.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>result_dir = Path(&quot;../../data/&quot;)
files_to_open = &quot;CAM_chem_merra2_FCSD_1deg_QFED_monthly_*.nc&quot;
#the netcdf files will be held in an xarray dataset named &#39;nc_load&#39; and can be referenced later in the notebook
nc_load = xr.open_mfdataset(str(result_dir/files_to_open),combine=&#39;by_coords&#39;,concat_dim=&#39;time&#39;)
#to see what the netCDF file contains, just call the variable you read it into
#nc_load
</pre></div>
</div>
</div>
<div class="section" id="extract-the-variable-at-the-time-and-level-and-location-of-choice">
<h2>Extract the variable at the time and level and location of choice<a class="headerlink" href="#extract-the-variable-at-the-time-and-level-and-location-of-choice" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>#extract variable
var_sel = nc_load[&#39;CO&#39;]

#extract grid variables
lat = nc_load[&#39;lat&#39;]
lon = nc_load[&#39;lon&#39;]
time = nc_load[&#39;time&#39;]

# CAM-chem writes the month average at midnight - i.e. the start of the next month.
# Reconfigure the time variable
time2 = pd.to_datetime(time.values,format=&#39;%Y-%m-%dT%H:%M:%S&#39;)+DateOffset(months=-1,days=+14)
print(&quot;file time: &quot;, time[0].values, &quot;---&gt; converted time: &quot;, time2[0])
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="n">time</span><span class="p">:</span>  <span class="mi">2018</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">01</span><span class="n">T00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.000000000</span> <span class="o">---&gt;</span> <span class="n">converted</span> <span class="n">time</span><span class="p">:</span>  <span class="mi">2018</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">15</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
</div>
<div class="section" id="select-and-extract-the-location">
<h2>Select and extract the location.<a class="headerlink" href="#select-and-extract-the-location" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>name_select = &quot;Boulder&quot;
lat_select = 40.0150
lon_select = 360-105.2705 # model longitude is from 0 to 360

lat_i = find_index(lat,lat_select)
lon_i = find_index(lon,lon_select)

print(name_select, &quot; latitude: &quot;, lat_select, &quot;---&gt; nearest: &quot;, lat[lat_i].values)
print(name_select, &quot; longitude: &quot;, lon_select, &quot;---&gt; nearest: &quot;, lon[lon_i].values)

# extract location surface value and convert to ppb
var_srf = var_sel.isel(lev=55, lat=lat_i,lon=lon_i)*1e09
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Boulder</span>  <span class="n">latitude</span><span class="p">:</span>  <span class="mf">40.015</span> <span class="o">---&gt;</span> <span class="n">nearest</span><span class="p">:</span>  <span class="mf">40.0523560209424</span>
<span class="n">Boulder</span>  <span class="n">longitude</span><span class="p">:</span>  <span class="mf">254.7295</span> <span class="o">---&gt;</span> <span class="n">nearest</span><span class="p">:</span>  <span class="mf">255.0</span>
</pre></div>
</div>
</div>
<div class="section" id="plot-the-value-versus-time">
<h2>Plot the value versus time.<a class="headerlink" href="#plot-the-value-versus-time" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>plt.figure(figsize=(20,8))

plt.plot(time2, var_srf, label=&#39;CAM-chem CO&#39;)

plt.title(&#39;CO at &#39; + name_select)
plt.xlabel(&#39;time&#39;)
plt.ylabel(&#39;CO (ppb)&#39;)
plt.legend()

plt.show()
</pre></div>
</div>
<img alt="../../_images/plot_timeseries_basic_13_0.png" src="../../_images/plot_timeseries_basic_13_0.png" />
</div>
</div>


      </main>

    </div>



    <footer class="text-light bg-dark pt-3">
      <div class="container" style="background-color:transparent; border:none">
        <div class="row">
          <div class="col-12 col-md">
            <a href="https://www2.acom.ucar.edu/"><img src="../../_static/img/ACOM-contemp-logo-white.png" alt="ACOM" class="ncar-logo"></a>
          </div>
          <div class="col-12 col-md-auto">
            <p class="footer-text copyright"><a href="https://www.ucar.edu/">University Corporation for Atmospheric Research</a> &copy; 2021<br>
            Built with <a href="https://www.sphinx-doc.org/en/master/" target="_blank" rel="noopener">Sphinx</a>. Proudly published with <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a><br>
            Created with the help of <a href="https://ncar.github.io/xdev/" target="_blank" rel="noopener">NCAR’s Xdev Team</a>. Apache 2.0</p>
          </div>
        </div>
        <div class="row pt-3 border-top">
          <div class="col-auto">
            <a href="https://nsf.gov/"><img src="../../_static/img/footer-logo-nsf.png" alt="NSF" class="nsf-logo"></a>
          </div>
          <div class="col">
            <p class="footer-text">This material is based upon work supported by the National Center for Atmospheric Research, a major facility
            sponsored by the National Science Foundation and managed by the University Corporation for Atmospheric Research. Any opinions,
            findings and conclusions or recommendations expressed in this material do not necessarily reflect the views of the National
            Science Foundation.</p>
          </div>
        </div>
      </div>
    </footer>


  </body>
</html>
